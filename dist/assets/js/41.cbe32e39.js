(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{650:function(a,t,e){"use strict";e.r(t);var _=e(5),r=Object(_.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("COMPATIBLE_MODE  选择MySQL")]),a._v(" "),e("h2",{attrs:{id:"常用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用"}},[a._v("#")]),a._v(" 常用")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('\n    @JsonFormat(pattern = "yyyy-MM-dd")\n    @DateTimeFormat(pattern = "yyyy-MM-dd")\n\n\nalter table "FSJCZX"."sample_detect_plan" add create_time datetime;\nalter table "FSJCZX"."sample_detect_plan" add create_user_id varchar(50);\nalter table "FSJCZX"."sample_detect_plan" add create_user_name varchar(100);\nalter table "FSJCZX"."sample_detect_plan" add update_time datetime;\nalter table "FSJCZX"."sample_detect_plan" add update_user_id varchar(50);\nalter table "FSJCZX"."sample_detect_plan" add update_user_name varchar(100);\n')])])]),e("h2",{attrs:{id:"dbeaver连接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dbeaver连接"}},[a._v("#")]),a._v(" DBeaver连接")]),a._v(" "),e("p",[a._v("达梦连接\n类名dm.jdbc.driver.DmDriver\nURL模板jdbc:dm://{host}[:{port}]/[{database}]")]),a._v(" "),e("h2",{attrs:{id:"dm-db的启动过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dm-db的启动过程"}},[a._v("#")]),a._v(" DM DB的启动过程")]),a._v(" "),e("p",[a._v("DM的启动主要按如下三个步骤进行：\n1.读取配置文件（.ini）\n2.读取控制文件(dm.ctl)\n3.读取重做日志文件（.log） 和 数据文件(*.DBF)")]),a._v(" "),e("p",[a._v("1，进入安装目录下的bin目录\n我的目录是（/home/user/dmdbms/bin）")]),a._v(" "),e("p",[a._v("2, 找到【dm.ini】文件所在的目录，不知道文件在那的可以执行下面搜索命令")]),a._v(" "),e("p",[a._v("find -name dm.ini")]),a._v(" "),e("p",[a._v("3，在 /home/user/dmdbms/bin 目录下执行")]),a._v(" "),e("p",[a._v("后台启动，一般建议用后台启动\nnohup ./dmserver /home/user/dmdba/dmdata/DAMENG/dm.ini &")]),a._v(" "),e("p",[a._v("前台启动（关闭窗口，数据库会关闭）\n./dmserver /home/user/dmdba/dmdata/DAMENG/dm.ini")]),a._v(" "),e("p",[a._v("4，查询服务启动情况")]),a._v(" "),e("p",[a._v("netstat -lntp |grep dm")]),a._v(" "),e("h2",{attrs:{id:"注"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注"}},[a._v("#")]),a._v(" 注：")]),a._v(" "),e("ol",[e("li",[a._v("使用达梦的迁移工具时，连mysql要像我们在代码里连数据库一样，指定编码，否则中文会乱码")]),a._v(" "),e("li",[a._v("达梦表查询转换为实体，实体存在枚举字段，查询会报错")]),a._v(" "),e("li",[a._v("达梦的Date类型字段，在实体用LocalDate会报错，要改成LocalDateTime")]),a._v(" "),e("li",[a._v("达梦双引号包着的英文区分大小写")]),a._v(" "),e("li",[a._v("查询中存在同名字段时，达梦默认取最后一个，MySQL默认取第一个")])]),a._v(" "),e("h2",{attrs:{id:"本地达梦"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本地达梦"}},[a._v("#")]),a._v(" 本地达梦")]),a._v(" "),e("p",[a._v("密码：dm863592923")]),a._v(" "),e("h2",{attrs:{id:"与mysql的区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#与mysql的区别"}},[a._v("#")]),a._v(" 与MySQL的区别")]),a._v(" "),e("h3",{attrs:{id:"分组查询group-concat和wm-concat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分组查询group-concat和wm-concat"}},[a._v("#")]),a._v(" 分组查询GROUP_CONCAT和WM_CONCAT")]),a._v(" "),e("p",[a._v("mysql用法  GROUP_CONCAT(c_remark SEPARATOR '!')  as remark    // 默认是,这里是将,改为！\n达梦用法  REPLACE(WM_CONCAT(\"c_remark\") ,',','!') as remark"),e("br"),a._v('\nWM_CONCAT("c_remark")为null时直接REPLACE会报"试图在blob或者clob列上排序或比较"错误，应改为下面的方式'),e("br"),a._v("\nREPLACE(  ,',','!') as remark")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("select\n    CAST( concat_ws('=',td.spot_name,td.object_name,ifnull(td.sample_deadline,'')) AS VARCHAR) as uniqueKey,\n    td.task_id,\n    td.task_detail_id,\n    td.spot_id,\n    td.spot_name ,\n    td.object_id,\n    td.object_name,\n    td.sample_deadline sampleDeadline,\n    REPLACE( WM_CONCAT( DISTINCT td.project_id) , ',' , '、') as projectIds,\n    REPLACE(WM_CONCAT(DISTINCT td.project_name) , ',' , '、')as projectNames    \nfrom task_detail td\nWHERE 1=1\nAND task_id = 1588363669413154818\nAND td.sample_deadline  >= '2023-01-01 00:00:00'\nand td.is_deleted = 0 \ngroup by DBMS_LOB.SUBSTR(uniqueKey)\n\n")])])]),e("h3",{attrs:{id:"date-add、date-sub和dateadd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#date-add、date-sub和dateadd"}},[a._v("#")]),a._v(" DATE_ADD、DATE_SUB和DATEADD")]),a._v(" "),e("p",[a._v("MySQL用法：DATE_ADD(a, INTERVAL b DAY)等同于DATE_SUB(a, INTERVAL -b DAY)"),e("br"),a._v("\n达梦用法：DATEADD( DAY , b, a )")]),a._v(" "),e("h3",{attrs:{id:"和"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#和"}},[a._v("#")]),a._v(" `和“")]),a._v(" "),e("p",[a._v("MySQL用法：a."),e("code",[a._v("name")]),a._v('\n达梦用法：a."name"')]),a._v(" "),e("h2",{attrs:{id:"递归查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#递归查询"}},[a._v("#")]),a._v(" 递归查询")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\nSELECT id,parent_id,department_name,\n\tLEVEL, -- 层级\n\tSYS_CONNECT_BY_PATH(department_name, ''), --全名\n\tCONNECT_BY_ROOT department_name, --根节点名称\n\tCONNECT_BY_ISLEAF, --是否叶子节点\nFROM sys_department d\nwhere 1=1\nAND CONNECT_BY_ROOT department_name like '广东省环境辐射监测中心' \nCONNECT BY PRIOR(id) = parent_id\n        \n")])])]),e("h2",{attrs:{id:"将查询的字段转换成字符串返回"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#将查询的字段转换成字符串返回"}},[a._v("#")]),a._v(" 将查询的字段转换成字符串返回")]),a._v(" "),e("p",[e("code",[a._v("SELECT CAST(field_name AS VARCHAR) FROM table_name;")])]),a._v(" "),e("h2",{attrs:{id:"将参数id类型转换为字符串-防止字符串转换错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#将参数id类型转换为字符串-防止字符串转换错误"}},[a._v("#")]),a._v(" 将参数id类型转换为字符串，防止字符串转换错误")]),a._v(" "),e("p",[e("code",[a._v("SELECT * FROM table_A WHERE a = CAST(#{id} AS VARCHAR)")])]),a._v(" "),e("h2",{attrs:{id:"函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[a._v("#")]),a._v(" 函数")]),a._v(" "),e("h3",{attrs:{id:"coalesce"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#coalesce"}},[a._v("#")]),a._v(" COALESCE")]),a._v(" "),e("p",[a._v("COALESCE 函数用于返回参数列表中的第一个非 NULL 表达式。如果所有参数都是 NULL，那么 COALESCE 返回 NULL")]),a._v(" "),e("h3",{attrs:{id:"datediff"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#datediff"}},[a._v("#")]),a._v(" DATEDIFF")]),a._v(" "),e("p",[a._v("获取两个时间相差的分钟数")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("SELECT DATEDIFF(MINUTE, MEASURE_BEGIN_TIME , MEASURE_END_TIME) AS minutes_difference\nFROM detect_record \n")])])]),e("h2",{attrs:{id:"增"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#增"}},[a._v("#")]),a._v(" 增")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('alter table "FSJCZX"."table_test" add column("operate" VARCHAR(50));\ncomment on column "FSJCZX"."table_test"."operate" is \'操作：锁定、申请解锁\';\n')])])]),e("h2",{attrs:{id:"删"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删"}},[a._v("#")]),a._v(" 删")]),a._v(" "),e("p",[a._v('alter table "FSJCZX"."table_test" drop column "abc";')]),a._v(" "),e("h2",{attrs:{id:"改-字段名-abc改成bcd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改-字段名-abc改成bcd"}},[a._v("#")]),a._v(" 改（字段名）abc改成bcd")]),a._v(" "),e("p",[e("code",[a._v('alter table "FSJCZX"."table_test" alter column "abc" rename to "bcd";')])]),a._v(" "),e("h2",{attrs:{id:"改-字段类型-改成integer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改-字段类型-改成integer"}},[a._v("#")]),a._v(" 改（字段类型）改成INTEGER")]),a._v(" "),e("p",[e("code",[a._v('alter table "FSJCZX"."table_test" modify "abc" INTEGER;')])]),a._v(" "),e("h2",{attrs:{id:"取消id自增"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#取消id自增"}},[a._v("#")]),a._v(" 取消id自增")]),a._v(" "),e("p",[e("code",[a._v('alter table "SPOT_MONITORING_EXPAND" drop identity;')])]),a._v(" "),e("h2",{attrs:{id:"更新"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新"}},[a._v("#")]),a._v(" 更新")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("UPDATE detect_record dr \nLEFT JOIN task_detail td ON td.TASK_DETAIL_ID = dr.TASK_DETAIL_ID \nLEFT JOIN task t ON t.TASK_ID = td.TASK_ID \nSET dr.task_type = t.TASK_TYPE \n")])])]),e("h2",{attrs:{id:"保留3为小数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#保留3为小数"}},[a._v("#")]),a._v(" 保留3为小数")]),a._v(" "),e("p",[a._v("round(a,3)")]),a._v(" "),e("p",[a._v("达梦数据库精度最大值是38")]),a._v(" "),e("h2",{attrs:{id:"长度"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#长度"}},[a._v("#")]),a._v(" 长度")]),a._v(" "),e("p",[a._v("length(a)")]),a._v(" "),e("h2",{attrs:{id:"sql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sql"}},[a._v("#")]),a._v(" SQL")]),a._v(" "),e("h3",{attrs:{id:"获取监测项目id、名称列表-有重复名称的则获取update-time最新的那个projectid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取监测项目id、名称列表-有重复名称的则获取update-time最新的那个projectid"}},[a._v("#")]),a._v(" 获取监测项目id、名称列表，有重复名称的则获取update_time最新的那个projectId")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v(' SELECT\n\ta.PROJECT_NAME AS "projectName",\n\tto_char(a.PROJECT_ID) AS "projectId",\n\tb.is_sample AS "isSample"\nFROM\n\t( WITH RankedProjects AS (\n\tSELECT\n\t\tPROJECT_NAME,\n\t\tPROJECT_ID,\n\t\tROW_NUMBER() \n\t\tOVER (PARTITION BY PROJECT_NAME ORDER BY update_time DESC) AS row_num\n\tFROM\n\t\tMONITORING_PROJECT\n\tWHERE\n\t\tUSABLE = 1 )\n\tSELECT\n\t\tDISTINCT PROJECT_NAME,\n\t\tPROJECT_ID\n\tFROM\n\t\tRankedProjects\n\tWHERE\n\t\trow_num = 1 ) a\nLEFT JOIN MONITORING_PROJECT_TERM t ON\n\tt.PROJECT_TERM_NAME = a.PROJECT_NAME\nLEFT JOIN PROJECT_BASE_TERM p ON\n\tp.PROJECT_TERM_ID = t.PROJECT_TERM_ID\nLEFT JOIN MONITORING_PROJECT_BASE b ON\n\tb.PROJECT_BASE_ID = p.PROJECT_BASE_ID;\n')])])])])}),[],!1,null,null,null);t.default=r.exports}}]);